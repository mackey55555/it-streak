-- ===============================================
-- 試験選択機能の追加
-- ===============================================

-- プロフィールに試験選択を追加
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS selected_exam_id UUID REFERENCES exams(id) ON DELETE SET NULL;

-- 既存ユーザーには基本情報技術者試験を設定
UPDATE profiles 
SET selected_exam_id = '00000000-0000-0000-0000-000000000001' 
WHERE selected_exam_id IS NULL;

-- 新規ユーザーにも基本情報技術者試験をデフォルト設定するようにトリガーを更新
-- （会員登録時に選択できるため、デフォルト値は設定しない）

-- 試験データを追加
INSERT INTO exams (id, name, description) VALUES
  ('00000000-0000-0000-0000-000000000002', '応用情報技術者試験', '基本情報技術者試験の上位試験。システム開発・運用の実践的な知識が問われる'),
  ('00000000-0000-0000-0000-000000000003', '情報セキュリティスペシャリスト', '情報セキュリティに関する高度な知識と技術が問われる'),
  ('00000000-0000-0000-0000-000000000004', 'ネットワークスペシャリスト', 'ネットワークシステムに関する高度な知識と技術が問われる'),
  ('00000000-0000-0000-0000-000000000005', 'データベーススペシャリスト', 'データベースシステムに関する高度な知識と技術が問われる'),
  ('00000000-0000-0000-0000-000000000006', 'システムアーキテクト', 'システム設計に関する高度な知識と技術が問われる'),
  ('00000000-0000-0000-0000-000000000007', 'プロジェクトマネージャ', 'プロジェクト管理に関する高度な知識と技術が問われる'),
  ('00000000-0000-0000-0000-000000000008', 'ITストラテジスト', 'IT戦略に関する高度な知識と技術が問われる')
ON CONFLICT DO NOTHING;
